<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>手动实现一个eventEmitter</title>
  </head>
  <body>
    <script>
      class EventEmitter {
        constructor() {
          this._events = Object.create(null); // 定义事件的存储对象
          this._eventsCount = 0;
        }
        //添加事件监听
        on(eventName, fn) {
          if (typeof fn !== "function") {
            throw new TypeError("The listener must be a function!");
          }
          if (!this._events[eventName]) {
            this._events[eventName] = [];
            this._events[eventName].push(fn);
          } else {
            this._events[eventName].push(fn); // 存入监听的事件名和事件
          }
        }

        // // 一次性事件监听
        // once(eventName,fn){

        // }

        // 时间触发
        emit(eventName, ...args) {
          if (!this._events[eventName]) {
            return false;
          }
          const len = this._events[eventName].length;
          for (let i = 0; i < len; i++) {
            let fn = this._events[eventName][i];
            fn.call(this, ...args);
          }
        }

        // 移除监听事件
        removeListener(eventName, fn) {
          if (!this._events[eventName]) return this;
          if (!fn) {
            delete this._events[eventName];
            return this;
          } else {
            if (this._events[eventName].includes(fn)) {
              const index = this._events[eventName].indexOf(fn);
              this._events[eventName].splice(index, 1);
            } else {
              return this;
            }
          }
        }
        // 移除所有监听事件
        removeAllListener(eventName) {
          if (eventName) {
            if (this._events[eventName]) {
              this._events[eventName].length = 0;
            }
          } else {
            this._events = Object.create(null);
          }
        }
      }

      function add(...args) {
        let num = 0;
        for (let i = 0; i < args.length; i++) {
          num += args[i];
        }
        console.log(num);
        return num;
      }
      // console.log(add(1,2,3))

      let event = new EventEmitter();
      event.on("adding", add);
      event.emit("adding", 1, 2, 3, 4);
      event.removeListener("adding", add);
      event.emit("adding", 1, 2, 3, 4);
    </script>
  </body>
</html>
